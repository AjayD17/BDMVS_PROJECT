{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results for {{ query }}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

</head>
<body>
    <h1>Search Results for: {{ query }}</h1>

    <div class="container">
        <!-- PDF Results Section -->
        <div id="book-results" class="panel left-panel">
            <h2>ğŸ“š Related Books</h2>
            <div id="pdf-results-container">
                
                <p>Loading PDF results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>

        <!-- Google Search Results Section -->
        <div id="google-results" class="panel left-panel">
            <h2>ğŸŒ Google Search Results</h2>
            <div id="google-results-container">
                
                <p>Loading Google results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>

        <!-- YouTube Results Section -->
        <div id="video-results" class="panel right-panel">
            <h2>ğŸ¬ Related Videos</h2>
            <div id="youtube-results-container">
                
                <p>Loading YouTube results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>
    </div>
 <script>
  
   document.addEventListener("DOMContentLoaded", function () {
    const searchWord = new URLSearchParams(window.location.search).get("search_word");

    // Select result containers
    const pdfContainer = document.getElementById("book-results");
    const googleContainer = document.getElementById("google-results");
    const youtubeContainer = document.getElementById("video-results");

    // Start all fetch requests simultaneously
    const pdfPromise = fetch(`/ajax/search_pdf/?search_word=${encodeURIComponent(searchWord)}`);
    const googlePromise = fetch(`/ajax/search_google/?search_word=${encodeURIComponent(searchWord)}`);
    const youtubePromise = fetch(`/ajax/search_youtube/?search_word=${encodeURIComponent(searchWord)}`);

    // Handle PDF results
    pdfPromise
        .then(response => response.json())
        .then(data => {
            if (data.pdf_results && data.pdf_results.length > 0) {
                pdfContainer.style.display = "block"; // Show panel if results are found
                displayResults('pdf-results-container', data.pdf_results, 'book-cover', '/static/covers.jpg', 'book-info');
            } else {
                pdfContainer.style.display = "none"; // Hide panel if no results
            }
        });

    // Handle Google results
    googlePromise
        .then(response => response.json())
        .then(data => displayResults('google-results-container', data.google_results, 'google-thumbnail', '/static/images/default_image.png', 'google-info'));

    // Handle YouTube results
    youtubePromise
        .then(response => response.json())
        .then(data => displayResults('youtube-results-container', data.youtube_results, 'video-thumbnail', '/static/images/default_thumbnail.jpg', 'video-info'));

    // Generic Display Function with Default Image Support
    function displayResults(containerId, results, imageClass, defaultImage, infoClass) {
        const container = document.getElementById(containerId);
        if (!results || results.length === 0) {
            container.innerHTML = "<p>No results found.</p>";
            return;
        }

        container.innerHTML = results.map(result => `
            <div class="result">
                <img src="${result.book_cover ? '/static/covers/' + result.book_cover : result.thumbnail || defaultImage}" 
                     alt="${result.book_name || result.title}" 
                     class="${imageClass}" 
                     loading="lazy">
                <div class="${infoClass}">
                    <h4>${result.book_name || result.title}</h4>
                    <a href="${result.download_link || result.videoUrl}" target="_blank">View</a>
                </div>
            </div>
        `).join('');
    }
});
</script>


</script>    
</body>
</html>
