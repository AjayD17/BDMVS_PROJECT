{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results for {{ query }}</title>
</head>

<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 20px;
    background: linear-gradient(to right, #6dd5ed, #2193b0);
}

h1 {
    margin-bottom: 20px;
}

#searchForm {
    margin-bottom: 20px;
}

#search_word {
    padding: 10px;
    width: 300px;
    margin-right: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

button {
    padding: 10px 16px;
    background-color: #007BFF;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
}

button:hover {
    background-color: #0056b3;
}

.container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    max-width: 1500px;
    margin: auto;
}

.panel {
    
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    box-sizing: border-box;
    height: 450px;
    overflow-y: auto;
    position: relative;
}

.panel h2 {
    position: sticky;
    top: 0;
    background-color: #ffffff;
    padding: 10px 0;
    margin-top: 0;
    border-bottom: 2px solid #2b73f9;
    z-index: 2;
}
h2{
    top:0px;
}

.panel::before {
    content: "";
    position: sticky;
    top: 0;
    height: 50px;
    background-color: #ffffff;
    z-index: 1;
}

.result {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 15px;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    height: 120px;
    box-sizing: border-box;
}

.book-cover, .video-thumbnail, .google-thumbnail {
    width: 100px;
    height: 100px;
    border-radius: 8px;
    object-fit: cover;
    margin-right: 15px;
}

.book-info, .video-info, .google-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: left;
    flex-grow: 1; 
}

.book-info h4, .video-info h4, .google-info h4 {
    margin: 0 0 5px 0;
    font-size: 16px;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.book-info a, .video-info a, .google-info a {
    color: #007BFF;
    text-decoration: none;
    font-weight: bold;
    margin-top: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow:hidden;
}

.book-info a:hover, .video-info a:hover, .google-info a:hover {
    text-decoration: underline;
}

@media (max-width: 992px) {
    .container {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {
    .container {
        grid-template-columns: 1fr;
    }
}

.hidden {
    display: none;
}
</style>



<body>
    {% include "navbar.html" %}
    <!-- Smaller Search Container -->
    <div class="search-container" 
     style="
        
         padding: 20px; /* Increased padding for spacious look */
         margin-bottom: 5px; 
         margin-top: 5px;
         text-align: center; 
         max-width: 700px; /* Significantly increased width */
         width: 85%; /* Maintains responsiveness */
         margin-left: auto;
         margin-right: auto;
     ">

        
        <form id="searchForm" method="GET" action="{% url 'search' %}">
            <input type="text" id="search_word" name="search_word"
                   value="{{ query }}" 
                   placeholder="Enter search word"
                   style="
                       padding: 8px;
                       width: 80%; 
                       border: 2px solid  #0dcaf0;
                       border-radius: 20px;
                       font-size: 2.2vh;
                       background-color: #ffffff;
                       color: #0452fd;"required>
            <button type="submit"
                    style="padding: 8px 16px; background-color: #0c92df; color: #fff; border: none; border-radius: 20px; cursor: pointer;gap:20px;">
                Search
            </button>
        </form>
    </div>

    <div class="container">
        <!-- PDF Results Section -->
        <div id="book-results" class="panel left-panel">
            <h2>üìö Related Books</h2>
            <div id="pdf-results-container">
                <p>Loading PDF results...</p>
            </div>
        </div>

        <!-- Google Search Results Section -->
        <div id="google-results" class="panel left-panel">
            <h2>üåê Google Search </h2>
            <div id="google-results-container">
                <p>Loading Google results...</p>
            </div>
        </div>

        <!-- YouTube Results Section -->
        <div id="video-results" class="panel right-panel">
            <h2>üé¨ Related Videos</h2>
            <div id="youtube-results-container">
                <p>Loading YouTube results...</p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchWord = new URLSearchParams(window.location.search).get("search_word") || "{{ query }}";

        const pdfContainer = document.getElementById("book-results");
        const googleContainer = document.getElementById("google-results");

        const googlePromise = fetch(`/ajax/search_google/?search_word=${encodeURIComponent(searchWord)}`)
            .then(response => response.json())
            .then(data => displayResults('google-results-container', data.google_results, 'google-thumbnail', '/static/images/default_image.png', 'google-info', 'Visit'));

        const youtubePromise = fetch(`/ajax/search_youtube/?search_word=${encodeURIComponent(searchWord)}`)
            .then(response => response.json())
            .then(data => displayResults('youtube-results-container', data.youtube_results, 'video-thumbnail', '/static/images/default_thumbnail.jpg', 'video-info', 'Watch'));

        const pdfStream = new EventSource(`/ajax/search_pdf/?search_word=${encodeURIComponent(searchWord)}`);
        pdfStream.onmessage = function (event) {
            const data = JSON.parse(event.data);
            appendBookResult(data);
            pdfContainer.style.display = "block"; 
        };

        function appendBookResult(data) {
            const pdfResultsContainer = document.getElementById('pdf-results-container');

            if (pdfResultsContainer.querySelector('p')) {
                pdfResultsContainer.innerHTML = ''; // Clear placeholder
            }

            const bookDiv = document.createElement('div');
            bookDiv.className = "result";
            const coverPath = data.book_cover.startsWith('/static') 
                              ? data.book_cover 
                              : `/static/covers/${data.book_cover}`;

            bookDiv.innerHTML = `
                <img src="${coverPath}" 
                     alt="${data.book_name}" 
                     class="book-cover" 
                     loading="lazy">
                <div class="book-info">
                    <h4>${data.book_name}</h4>
                    <a href="${data.download_link}" target="_blank">Download</a>
                </div>
            `;
            pdfResultsContainer.appendChild(bookDiv);
        }

        function displayResults(containerId, results, imageClass, defaultImage, infoClass, linkText) {
            const container = document.getElementById(containerId);
            if (!results || results.length === 0) {
                container.innerHTML = "<p>No results found.</p>";
                return;
            }

            container.innerHTML = results.map(result => `
                <div class="result">
                    <img src="${result.book_cover ? '/static/covers/' + result.book_cover : result.thumbnail || defaultImage}" 
                         alt="${result.book_name || result.title}" 
                         class="${imageClass}" 
                         loading="lazy">
                    <div class="${infoClass}">
                        <h4>${result.book_name || result.title}</h4>
                        <a href="${result.download_link || result.videoUrl}" target="_blank">${linkText}</a>
                    </div>
                </div>
            `).join('');
        }
    });
    </script>
</body>
</html>
