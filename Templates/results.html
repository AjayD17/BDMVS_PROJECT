{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'Bootstrap/css/bootstrap.min.css' %}">
</head>
<style>
    body{
        background: linear-gradient(to right, #6dd5ed, #2193b0);
    }

    .panel {
        padding: 0;
        background-color: #F0F0F0;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
        height: 100%;
        overflow-y: auto;
        padding-top: 3vh;
    }

    @media (min-width: 768px) {
    .container, .container-md, .container-sm {
        max-width: 100%;
    }
    }

</style>
<body>
    {% include "navbar.html" %}
    <!-- Smaller Search Container -->
    <div class="search-container" 
     style="
         padding: 20px; /* Increased padding for spacious look */
         margin-bottom: 5px; 
         margin-top: 5px;
         text-align: center; 
         max-width: 700px; /* Significantly increased width */
         width: 85%; /* Maintains responsiveness */
         margin-left: auto;
         margin-right: auto;
     ">
    
    <form id="searchForm" method="GET" action="{% url 'search' %}">
        <input type="text" id="search_word" name="search_word"
               value="{{ query }}" 
               placeholder="Enter search word"
               style="
                   padding: 8px;
                   width: 80%; 
                   border: 2px solid  #0dcaf0;
                   border-radius: 20px;
                   font-size: 2.2vh;
                   background-color: #ffffff;
                   color: #0452fd;"required>
        <button type="submit"
                style="padding: 8px 16px; background-color: #0c92df; color: #fff; border: none; border-radius: 20px; cursor: pointer;gap:20px;">
            Search
        </button>
    </form>
</div>

    <div class="container">
        <!-- PDF Results Section -->
        <div id="book-results" class="panel left-panel">
            <h3 class="pl-2">📚 Related Books</h3>
            <div id="pdf-results-container" class="pl-2">
                
                <p>Loading PDF results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>

        <!-- Google Search Results Section -->
        <div id="google-results" class="panel left-panel">
            <h2>🌐 Google Search</h2>
            <div id="google-results-container">
            <h3 class="pl-2">🌐 Google Search Results</h3>
            <div id="google-results-container" class="pl-2">
                
                <p>Loading Google results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>

        <!-- YouTube Results Section -->
        <div id="video-results" class="panel right-panel">
            <h3>🎬 Related Videos</h3>
            <div id="youtube-results-container" class="pl-2">
                
                <p>Loading YouTube results...</p>  <!-- Placeholder for async results -->
            </div>
        </div>
    </div>
 <script>
  
   document.addEventListener("DOMContentLoaded", function () {
    const searchWord = new URLSearchParams(window.location.search).get("search_word");

    // Select result containers
    const pdfContainer = document.getElementById("book-results");
    const googleContainer = document.getElementById("google-results");
    const youtubeContainer = document.getElementById("video-results");

    // Start all fetch requests simultaneously
    const pdfPromise = fetch(`/ajax/search_pdf/?search_word=${encodeURIComponent(searchWord)}`);
    const googlePromise = fetch(`/ajax/search_google/?search_word=${encodeURIComponent(searchWord)}`);
    const youtubePromise = fetch(`/ajax/search_youtube/?search_word=${encodeURIComponent(searchWord)}`);

    // Handle PDF results
    pdfPromise
        .then(response => response.json())
        .then(data => {
            if (data.pdf_results && data.pdf_results.length > 0) {
                pdfContainer.style.display = "block"; // Show panel if results are found
                displayResults('pdf-results-container', data.pdf_results, 'book-cover', '/static/covers.jpg', 'book-info');
            } else {
                pdfContainer.style.display = "none"; // Hide panel if no results
            }
        });

    // Handle Google results
    googlePromise
        .then(response => response.json())
        .then(data => displayResults('google-results-container', data.google_results, 'google-thumbnail', '/static/images/default_image.png', 'google-info'));

    // Handle YouTube results
    youtubePromise
        .then(response => response.json())
        .then(data => displayResults('youtube-results-container', data.youtube_results, 'video-thumbnail', '/static/images/default_thumbnail.jpg', 'video-info'));

    // Generic Display Function with Default Image Support
    function displayResults(containerId, results, imageClass, defaultImage, infoClass) {
        const container = document.getElementById(containerId);
        if (!results || results.length === 0) {
            container.innerHTML = "<p>No results found.</p>";
            return;
        }

        container.innerHTML = results.map(result => `
            <div class="result">
                <img src="${result.book_cover ? '/static/covers/' + result.book_cover : result.thumbnail || defaultImage}" 
                     alt="${result.book_name || result.title}" 
                     class="${imageClass}" 
                     loading="lazy">
                <div class="${infoClass}">
                    <h4>${result.book_name || result.title}</h4>
                    <a href="${result.download_link || result.videoUrl}" target="_blank">View</a>
                </div>
            </div>
        `).join('');
    }
});
</script>


</script>    
</body>
</html>
